<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Danh sách người đã nhập tên</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; text-align: center; }
  table { border-collapse: collapse; width: 100%; background: white; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
  th { background: #4CAF50; color: white; }
  .back-btn { margin: 15px 0; display: inline-block; color: blue; cursor: pointer; text-decoration: underline; }
</style>
</head>
<body>

<h2>📋 Danh sách đã nhập tên (Firebase)</h2>
<div class="back-btn" onclick="window.location.href='index.html'">⬅ Quay lại</div>

<table id="nameTable">
  <thead>
    <tr><th>Thời gian</th><th>Tên</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, query, orderByChild, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyD962crs2BgxZIRQVYroUH4Ih4vL3VI_48",
  authDomain: "hihi-3c544.firebaseapp.com",
  databaseURL: "https://hihi-3c544-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "hihi-3c544",
  storageBucket: "hihi-3c544.firebasestorage.app",
  messagingSenderId: "799975042765",
  appId: "1:799975042765:web:d23ead7aa29deffcc0c384",
  measurementId: "G-W5FLH85R0R"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);
signInAnonymously(auth).catch(() => {});

const tbody = document.querySelector("#nameTable tbody");
const q = query(ref(db, "names"), orderByChild("createdAt"));

onValue(q, (snapshot) => {
  const list = [];
  snapshot.forEach(child => list.push(child.val()));
  list.sort((a,b) => (a.createdAt||0) - (b.createdAt||0));
  tbody.innerHTML = "";
  if (list.length === 0) {
    tbody.innerHTML = "<tr><td colspan='2'>Chưa có ai nhập tên</td></tr>";
    return;
  }
  for (const item of list) {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${item.time || ""}</td><td>${item.name || ""}</td>`;
    tbody.appendChild(tr);
  }
});
</script>

</body>
</html>
